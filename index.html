<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>To-Do App</title>
  <style>
    :root {
      --primary-bg: linear-gradient(135deg, #8b0000, #5d0000);
      --light-bg: #f5f5f5;
      --dark-bg: #121212;
      --primary-text: #ffffff;
      --dark-text: #333333;
      --light-text: #f5f5f5;
      --accent-color: #007bff;
      --success-color: #28a745;
      --warning-color: #ffc107;
      --danger-color: #dc3545;
      --grey-color: #6c757d;
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-bg-dark: rgba(30, 30, 30, 0.9);
      --shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      --border-radius: 8px;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: var(--primary-bg);
      color: var(--primary-text);
      transition: all 0.3s ease;
    }

    body.dark-mode {
      --card-bg: var(--card-bg-dark);
      --primary-text: var(--light-text);
      background: var(--dark-bg);
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    .login-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 30px;
      width: 100%;
      max-width: 400px;
      color: var(--dark-text);
    }

    .login-card h2 {
      text-align: center;
      margin-bottom: 30px;
      color: #8b0000;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 16px;
      box-sizing: border-box;
    }

    .btn {
      padding: 12px 20px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: inline-block;
      text-align: center;
      margin-right: 10px;
    }

    .btn-primary {
      background: var(--accent-color);
      color: white;
    }

    .btn-success {
      background: var(--success-color);
      color: white;
    }

    .btn-secondary {
      background: var(--grey-color);
      color: white;
    }

    .btn-danger {
      background: var(--danger-color);
      color: white;
    }

    .btn-light {
      background: #f8f9fa;
      color: #333;
      border: 1px solid #ddd;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .login-btn {
      width: 100%;
      background: #8b0000;
      color: white;
      position: relative;
      overflow: hidden;
    }

    .login-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      animation: lightEffect 2s infinite;
    }

    @keyframes lightEffect {
      0% { left: -100%; }
      100% { left: 100%; }
    }

    .register-link {
      text-align: center;
      margin-top: 20px;
    }

    .register-link a {
      color: #00008b;
      font-weight: 600;
      cursor: pointer;
      text-decoration: none;
    }

    .register-link a:hover {
      text-decoration: underline;
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 30px;
      width: 100%;
      max-width: 500px;
      color: var(--dark-text);
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      margin: 0;
      color: #8b0000;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: var(--grey-color);
    }

    .dashboard {
      display: none;
    }

    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
    }

    .app-title {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
    }

    .user-controls {
      display: flex;
      align-items: center;
    }

    .timer-display {
      background: rgba(0, 0, 0, 0.2);
      padding: 8px 15px;
      border-radius: var(--border-radius);
      margin-right: 15px;
      font-weight: 600;
    }

    .theme-switch {
      margin: 0 15px;
      width: 60px;
      height: 30px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      position: relative;
      cursor: pointer;
    }

    .theme-switch::after {
      content: '';
      position: absolute;
      width: 26px;
      height: 26px;
      background: white;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s ease;
    }

    .theme-switch.active::after {
      left: 32px;
    }

    .user-profile {
      position: relative;
    }

    .profile-img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      object-fit: cover;
      border: 2px solid white;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger-color);
      color: white;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 12px;
      font-weight: 600;
    }

    .dropdown-menu {
      position: absolute;
      top: 50px;
      right: 0;
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      width: 200px;
      z-index: 100;
      display: none;
    }

    .dropdown-menu.active {
      display: block;
    }

    .dropdown-item {
      padding: 12px 15px;
      display: block;
      color: var(--dark-text);
      text-decoration: none;
      transition: all 0.2s ease;
    }

    .dropdown-item:hover {
      background: rgba(0, 0, 0, 0.05);
    }

    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      color: var(--dark-text);
    }

    .stat-card h3 {
      margin-top: 0;
      margin-bottom: 10px;
      color: #8b0000;
    }

    .stat-card .number {
      font-size: 36px;
      font-weight: 700;
    }

    .completed-card .number {
      color: var(--success-color);
    }

    .pending-card .number {
      color: var(--warning-color);
    }

    .tasks-section {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow);
      margin-bottom: 30px;
      color: var(--dark-text);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .section-title {
      font-size: 20px;
      font-weight: 700;
      margin: 0;
      color: #8b0000;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
    }

    .filters-row {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
    }

    .filter-group {
      flex: 1;
      min-width: 200px;
    }

    .filter-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
    }

    .filter-group select,
    .filter-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
    }

    .search-box {
      flex: 2;
      min-width: 300px;
    }

    .search-box input {
      width: 100%;
      padding: 8px 15px;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      font-size: 16px;
    }

    .view-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .batch-actions {
      display: none;
    }

    .batch-actions.active {
      display: flex;
      gap: 10px;
    }

    .view-switcher {
      display: flex;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      overflow: hidden;
    }

    .view-option {
      padding: 8px 15px;
      background: #f5f5f5;
      cursor: pointer;
      border: none;
    }

    .view-option.active {
      background: var(--accent-color);
      color: white;
    }

    .task-list {
      margin-top: 20px;
    }

    .task-item {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
      padding: 15px;
      margin-bottom: 15px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      overflow: hidden;
      transition: all 0.3s ease;
    }

    .task-item.completed {
      background: rgba(40, 167, 69, 0.1);
    }

    .priority-indicator {
      position: absolute;
      top: 0;
      left: 0;
      width: 5px;
      height: 100%;
    }

    .priority-high {
      background: var(--danger-color);
    }

    .priority-medium {
      background: var(--warning-color);
    }

    .priority-low {
      background: var(--grey-color);
    }

    .due-indicator {
      position: absolute;
      top: 0;
      right: 0;
      width: 5px;
      height: 100%;
    }

    .due-expired {
      background: var(--danger-color);
    }

    .due-soon {
      background: var(--warning-color);
    }

    .due-ok {
      background: var(--success-color);
    }

    .task-info {
      flex: 1;
      padding-left: 15px;
    }

    .task-title {
      font-weight: 600;
      margin-bottom: 5px;
      color: #333;
    }

    .task-meta {
      display: flex;
      gap: 15px;
      color: #666;
      font-size: 14px;
    }

    .task-actions {
      display: flex;
      gap: 10px;
    }

    .task-action-btn {
      background: none;
      border: none;
      padding: 5px;
      cursor: pointer;
      color: #666;
      transition: all 0.2s ease;
    }

    .task-action-btn:hover {
      color: var(--accent-color);
    }

    .task-checkbox {
      width: 20px;
      height: 20px;
      margin-right: 10px;
    }

    .graphs-view {
      display: none;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .graph-container {
      background: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 20px;
      height: 300px;
      display: flex;
      flex-direction: column;
    }

    .graph-title {
      text-align: center;
      margin-top: 0;
      margin-bottom: 20px;
      color: #8b0000;
    }

    .bar-chart {
      display: flex;
      height: 200px;
      align-items: flex-end;
      gap: 30px;
      justify-content: center;
    }

    .bar {
      width: 80px;
      background: #ddd;
      position: relative;
      transition: height 0.5s ease;
    }

    .bar-label {
      position: absolute;
      bottom: -25px;
      left: 0;
      right: 0;
      text-align: center;
    }

    .bar-value {
      position: absolute;
      top: -25px;
      left: 0;
      right: 0;
      text-align: center;
    }

    .completed-bar {
      background: var(--success-color);
    }

    .pending-bar {
      background: var(--warning-color);
    }

    .pie-chart {
      position: relative;
      width: 200px;
      height: 200px;
      margin: 0 auto;
    }

    .pie-slice {
      position: absolute;
      width: 100%;
      height: 100%;
      clip-path: polygon(50% 50%, 100% 0, 100% 100%);
      transform-origin: center;
    }

    .pie-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .legend-color {
      width: 15px;
      height: 15px;
      border-radius: 3px;
    }

    .users-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .user-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow);
      padding: 20px;
      text-align: center;
      color: var(--dark-text);
    }

    .user-card img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 15px;
    }

    .user-card h3 {
      margin: 10px 0 5px;
    }

    .user-card p {
      margin: 5px 0;
      color: #666;
    }

    .profile-card {
      text-align: center;
      padding-bottom: 20px;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .profile-img-lg {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 20px;
      border: 3px solid #8b0000;
    }

    .profile-info {
      margin-bottom: 30px;
    }

    .profile-info-item {
      display: flex;
      margin-bottom: 10px;
    }

    .profile-info-label {
      width: 120px;
      font-weight: 600;
      color: #666;
    }

    .profile-info-value {
      flex: 1;
    }

    @media (max-width: 768px) {
      .stats-container {
        grid-template-columns: 1fr;
      }

      .graphs-view {
        grid-template-columns: 1fr;
      }

      .filters-row,
      .section-header,
      .dashboard-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }

      .action-buttons {
        width: 100%;
        justify-content: flex-start;
      }

      .task-item {
        flex-direction: column;
        align-items: flex-start;
      }

      .task-actions {
        margin-top: 15px;
        width: 100%;
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <!-- Login Page -->
  <div class="login-container" id="loginPage">
    <div class="login-card">
      <h2>Welcome to To-Do App</h2>
      <div class="form-group">
        <label for="email">Email:</label>
        <input type="email" id="email" placeholder="Enter your email" value="test@example.com">
      </div>
      <div class="form-group">
        <label for="password">Password:</label>
        <input type="password" id="password" placeholder="Enter your password" value="123456" autocomplete="current-password">
      </div>
      <button class="btn login-btn" id="loginBtn">Login</button>
      <div class="register-link">
        Don't have an account? <a id="registerLink">Register now</a>
      </div>
    </div>
  </div>

  <!-- Registration Modal -->
  <div class="modal" id="registrationModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Create New Account</h2>
        <button class="close-btn">&times;</button>
      </div>
      <form id="registrationForm">
        <div class="form-group">
          <label for="firstName">First Name:</label>
          <input type="text" id="firstName" required>
        </div>
        <div class="form-group">
          <label for="lastName">Last Name:</label>
          <input type="text" id="lastName" required>
        </div>
        <div class="form-group">
          <label for="regEmail">Email:</label>
          <input type="email" id="regEmail" required>
        </div>
        <div class="form-group">
          <label for="confirmEmail">Confirm Email:</label>
          <input type="email" id="confirmEmail" required>
        </div>
        <div class="form-group">
          <label for="regPassword">Password:</label>
          <input type="password" id="regPassword" required autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="confirmPassword">Confirm Password:</label>
          <input type="password" id="confirmPassword" required autocomplete="new-password">
        </div>
        <div class="form-group">
          <label for="birthdate">Birthdate:</label>
          <input type="date" id="birthdate" required>
        </div>
        <div class="form-group">
          <label for="nationality">Nationality:</label>
          <select id="nationality" required>
            <option value="">Select Country</option>
            <option value="USA">United States</option>
            <option value="UK">United Kingdom</option>
            <option value="Canada">Canada</option>
            <option value="Australia">Australia</option>
            <option value="Germany">Germany</option>
            <option value="France">France</option>
            <option value="Japan">Japan</option>
            <option value="China">China</option>
            <option value="India">India</option>
            <option value="Brazil">Brazil</option>
            <option value="South Africa">South Africa</option>
          </select>
        </div>
        <div class="form-group">
          <label for="role">Role:</label>
          <select id="role" required>
            <option value="">Select Role</option>
            <option value="Manager">Manager</option>
            <option value="Staff">Staff</option>
            <option value="Customer">Customer</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
        <div style="display: flex; gap: 10px;">
          <button type="submit" class="btn btn-success">Create</button>
          <button type="button" class="btn btn-secondary" id="cancelRegistration">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Dashboard -->
  <div class="dashboard" id="dashboard">
    <div class="container">
      <!-- Dashboard Header -->
      <div class="dashboard-header">
        <h1 class="app-title">To-Do App</h1>
        <div class="user-controls">
          <div class="timer-display" id="timerDisplay">00:00:00</div>
          <div class="theme-switch" id="themeSwitch"></div>
          <div class="user-profile">
            <img src="/api/placeholder/200/200" alt="User Profile" class="profile-img" id="profileImg">
            <span class="notification-badge" id="notificationBadge">3</span>
            <div class="dropdown-menu" id="profileDropdown">
              <a class="dropdown-item" id="viewProfileBtn">View Profile</a>
              <a class="dropdown-item" id="editProfileBtn">Edit Profile</a>
              <a class="dropdown-item" id="logoutBtn">Logout</a>
            </div>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div style="margin-bottom: 30px;">
        <button class="btn btn-primary" id="dashboardNav">Dashboard</button>
        <button class="btn btn-light" id="usersNav">Users</button>
      </div>

      <!-- Dashboard Content -->
      <div id="dashboardContent">
        <!-- Stats Cards -->
        <div class="stats-container">
          <div class="stat-card">
            <h3>Total Tasks</h3>
            <div class="number" id="totalTasksCount">12</div>
          </div>
          <div class="stat-card completed-card">
            <h3>Completed Tasks</h3>
            <div class="number" id="completedTasksCount">5</div>
          </div>
          <div class="stat-card pending-card">
            <h3>Pending Tasks</h3>
            <div class="number" id="pendingTasksCount">7</div>
          </div>
        </div>

        <!-- Tasks Section -->
        <div class="tasks-section">
          <div class="section-header">
            <h2 class="section-title">Tasks</h2>
            <div class="action-buttons">
              <button class="btn btn-success" id="addTaskBtn">+ Add Task</button>
              <button class="btn btn-light" id="exportBtn">
                <span class="icon">ðŸ“¤</span> Export
              </button>
              <button class="btn btn-light" id="importBtn">
                <span class="icon">ðŸ“¥</span> Import
              </button>
            </div>
          </div>
          
          <!-- Filters -->
          <div class="filters-row">
            <div class="filter-group">
              <label for="statusFilter">Status</label>
              <select id="statusFilter">
                <option value="all">All</option>
                <option value="active">Active</option>
                <option value="completed">Completed</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="categoryFilter">Category</label>
              <select id="categoryFilter">
                <option value="all">All Categories</option>
                <option value="work">Work</option>
                <option value="personal">Personal</option>
                <option value="health">Health</option>
                <option value="education">Education</option>
                <option value="finance">Finance</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="priorityFilter">Priority</label>
              <select id="priorityFilter">
                <option value="all">All Priorities</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="dueDateFilter">Due Date</label>
              <select id="dueDateFilter">
                <option value="all">All Dates</option>
                <option value="today">Today</option>
                <option value="week">This Week</option>
                <option value="month">This Month</option>
                <option value="custom">Custom</option>
              </select>
            </div>
            <div class="search-box">
              <label for="searchInput">Search</label>
              <input type="text" id="searchInput" placeholder="Search tasks...">
            </div>
          </div>
          
          <!-- View Controls -->
          <div class="view-controls">
            <div class="batch-actions" id="batchActions">
              <button class="btn btn-danger btn-sm" id="batchDeleteBtn">Delete Selected</button>
              <button class="btn btn-success btn-sm" id="batchCompleteBtn">Mark Complete</button>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-light btn-sm" id="undoBtn">â†© Undo</button>
              <button class="btn btn-light btn-sm" id="redoBtn">â†ª Redo</button>
              <div class="view-switcher">
                <button class="view-option active" id="listViewBtn">List View</button>
                <button class="view-option" id="graphViewBtn">Graph View</button>
              </div>
            </div>
          </div>
          
          <!-- Task List -->
          <div class="task-list" id="taskList">
            <!-- Tasks will be inserted here by JavaScript -->
          </div>
          
          <!-- Graphs View -->
          <div class="graphs-view" id="graphsView">
            <div class="graph-container">
              <h3 class="graph-title">Tasks Progress</h3>
              <div class="bar-chart">
                <div class="bar completed-bar" style="height: 120px;">
                  <div class="bar-value">5</div>
                  <div class="bar-label">Completed</div>
                </div>
                <div class="bar pending-bar" style="height: 180px;">
                  <div class="bar-value">7</div>
                  <div class="bar-label">Pending</div>
                </div>
              </div>
            </div>
            <div class="graph-container">
              <h3 class="graph-title">Tasks Distribution</h3>
              <div class="pie-chart" id="pieChart">
                <!-- Pie chart will be drawn by JavaScript -->
                <div class="pie-slice" style="background-color: var(--success-color); transform: rotate(0deg); clip-path: polygon(50% 50%, 50% 0, 150% 0, 150% 150%, 50% 150%);"></div>
                <div class="pie-slice" style="background-color: var(--warning-color); transform: rotate(152deg); clip-path: polygon(50% 50%, 50% 0, 150% 0, 150% 150%, 50% 150%);"></div>
              </div>
              <div class="pie-legend">
                <div class="legend-item">
                  <div class="legend-color" style="background-color: var(--success-color);"></div><span>Completed (42%)</span>
                </div>
                <div class="legend-item">
                  <div class="legend-color" style="background-color: var(--warning-color);"></div>
                  <span>Pending (58%)</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Users Section -->
      <div id="usersContent" style="display: none;">
        <h2 class="section-title" style="margin-bottom: 20px;">Users</h2>
        <div class="users-container" id="usersContainer">
          <!-- Users will be inserted here by JavaScript -->
        </div>
      </div>
    </div>
  </div>

  <!-- View Profile Modal -->
  <div class="modal" id="profileModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>User Profile</h2>
        <button class="close-btn">&times;</button>
      </div>
      <div class="profile-card">
        <img src="/api/placeholder/200/200" alt="Profile" class="profile-img-lg" id="profileImgLg">
        <h3 id="profileName">John Doe</h3>
        <p id="profileRole">Manager</p>
      </div>
      <div class="profile-info">
        <div class="profile-info-item">
          <div class="profile-info-label">Email:</div>
          <div class="profile-info-value" id="profileEmail">john.doe@example.com</div>
        </div>
        <div class="profile-info-item">
          <div class="profile-info-label">Phone:</div>
          <div class="profile-info-value" id="profilePhone">+1 (555) 123-4567</div>
        </div>
        <div class="profile-info-item">
          <div class="profile-info-label">Country:</div>
          <div class="profile-info-value" id="profileCountry">United States</div>
        </div>
        <div class="profile-info-item">
          <div class="profile-info-label">Birth Date:</div>
          <div class="profile-info-value" id="profileBirthdate">January 15, 1985</div>
        </div>
        <div class="profile-info-item">
          <div class="profile-info-label">Joining Date:</div>
          <div class="profile-info-value" id="profileJoiningDate">March 10, 2023</div>
        </div>
      </div>
      <div style="display: flex; justify-content: flex-end; gap: 10px;">
        <button class="btn btn-primary" id="editProfileBtn2">Edit Profile</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal" id="editProfileModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Profile</h2>
        <button class="close-btn">&times;</button>
      </div>
      <form id="editProfileForm">
        <div style="text-align: center; margin-bottom: 20px;">
          <img src="/api/placeholder/200/200" alt="Profile" class="profile-img-lg" id="editProfileImg">
          <div style="margin-top: 10px;">
            <button type="button" class="btn btn-light" id="changeProfilePicBtn">Change Picture</button>
            <input type="file" id="profilePicInput" style="display: none;">
          </div>
        </div>
        <div class="form-group">
          <label for="editFirstName">First Name:</label>
          <input type="text" id="editFirstName" required>
        </div>
        <div class="form-group">
          <label for="editLastName">Last Name:</label>
          <input type="text" id="editLastName" required>
        </div>
        <div class="form-group">
          <label for="editEmail">Email:</label>
          <input type="email" id="editEmail" required>
        </div>
        <div class="form-group">
          <label for="editPhone">Phone:</label>
          <input type="tel" id="editPhone">
        </div>
        <div class="form-group">
          <label for="editCountry">Country:</label>
          <select id="editCountry">
            <option value="USA">United States</option>
            <option value="UK">United Kingdom</option>
            <option value="Canada">Canada</option>
            <option value="Australia">Australia</option>
            <option value="Germany">Germany</option>
            <option value="France">France</option>
            <option value="Japan">Japan</option>
            <option value="China">China</option>
            <option value="India">India</option>
            <option value="Brazil">Brazil</option>
            <option value="South Africa">South Africa</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editBirthdate">Birthdate:</label>
          <input type="date" id="editBirthdate">
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="submit" class="btn btn-success">Save Changes</button>
          <button type="button" class="btn btn-secondary" id="cancelEditProfile">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Add Task Modal -->
  <div class="modal" id="addTaskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Add New Task</h2>
        <button class="close-btn">&times;</button>
      </div>
      <form id="addTaskForm">
        <div class="form-group">
          <label for="taskTitle">Title:</label>
          <input type="text" id="taskTitle" required>
        </div>
        <div class="form-group">
          <label for="taskDescription">Description:</label>
          <textarea id="taskDescription" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
        </div>
        <div class="form-group" id="subTasksContainer">
          <label>Sub Tasks:</label>
          <div id="subTasksList">
            <div class="sub-task-item" style="display: flex; gap: 10px; margin-bottom: 10px;">
              <input type="text" placeholder="Sub task" style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 8px;">
              <button type="button" class="btn btn-danger btn-sm remove-sub-task">Ã—</button>
            </div>
          </div>
          <button type="button" class="btn btn-light btn-sm" id="addSubTaskBtn" style="margin-top: 10px;">+ Add Sub Task</button>
        </div>
        <div class="form-group">
          <label for="taskDueDate">Due Date:</label>
          <input type="date" id="taskDueDate" required>
        </div>
        <div class="form-group">
          <label for="taskPriority">Priority:</label>
          <select id="taskPriority" required>
            <option value="high">High</option>
            <option value="medium" selected>Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="form-group">
          <label for="taskCategory">Category:</label>
          <select id="taskCategory" required>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
            <option value="health">Health</option>
            <option value="education">Education</option>
            <option value="finance">Finance</option>
          </select>
        </div>
        <div class="form-group">
          <label for="taskNotes">Notes:</label>
          <textarea id="taskNotes" rows="2" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="submit" class="btn btn-success">Create</button>
          <button type="button" class="btn btn-secondary" id="cancelAddTask">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- View Task Modal -->
  <div class="modal" id="viewTaskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="viewTaskTitle">Task Title</h2>
        <button class="close-btn">&times;</button>
      </div>
      <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 5px;">Description:</div>
        <div id="viewTaskDescription">Task description goes here...</div>
      </div>
      <div style="margin-bottom: 20px;" id="viewSubTasksContainer">
        <div style="font-weight: 600; margin-bottom: 5px;">Sub Tasks:</div>
        <ul id="viewSubTasksList">
          <!-- Sub tasks will be added here -->
        </ul>
      </div>
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
        <div>
          <div style="font-weight: 600; margin-bottom: 5px;">Due Date:</div>
          <div id="viewTaskDueDate">April 30, 2025</div>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 5px;">Priority:</div>
          <div id="viewTaskPriority">Medium</div>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 5px;">Category:</div>
          <div id="viewTaskCategory">Work</div>
        </div>
        <div>
          <div style="font-weight: 600; margin-bottom: 5px;">Status:</div>
          <div id="viewTaskStatus">Active</div>
        </div>
      </div>
      <div style="margin-bottom: 20px;">
        <div style="font-weight: 600; margin-bottom: 5px;">Notes:</div>
        <div id="viewTaskNotes">Additional notes go here...</div>
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn btn-primary" id="viewTaskEditBtn">Edit</button>
        <button class="btn btn-success" id="viewTaskToggleBtn">Mark Complete</button>
        <button class="btn btn-light" id="viewTaskCloseBtn">Close</button>
      </div>
    </div>
  </div>

  <!-- Edit Task Modal -->
  <div class="modal" id="editTaskModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Edit Task</h2>
        <button class="close-btn">&times;</button>
      </div>
      <form id="editTaskForm">
        <input type="hidden" id="editTaskId">
        <div class="form-group">
          <label for="editTaskTitle">Title:</label>
          <input type="text" id="editTaskTitle" required>
        </div>
        <div class="form-group">
          <label for="editTaskDescription">Description:</label>
          <textarea id="editTaskDescription" rows="3" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
        </div>
        <div class="form-group" id="editSubTasksContainer">
          <label>Sub Tasks:</label>
          <div id="editSubTasksList">
            <!-- Sub tasks will be added here -->
          </div>
          <button type="button" class="btn btn-light btn-sm" id="editAddSubTaskBtn" style="margin-top: 10px;">+ Add Sub Task</button>
        </div>
        <div class="form-group">
          <label for="editTaskDueDate">Due Date:</label>
          <input type="date" id="editTaskDueDate" required>
        </div>
        <div class="form-group">
          <label for="editTaskPriority">Priority:</label>
          <select id="editTaskPriority" required>
            <option value="high">High</option>
            <option value="medium">Medium</option>
            <option value="low">Low</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editTaskCategory">Category:</label>
          <select id="editTaskCategory" required>
            <option value="work">Work</option>
            <option value="personal">Personal</option>
            <option value="health">Health</option>
            <option value="education">Education</option>
            <option value="finance">Finance</option>
          </select>
        </div>
        <div class="form-group">
          <label for="editTaskNotes">Notes:</label>
          <textarea id="editTaskNotes" rows="2" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px;"></textarea>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end;">
          <button type="submit" class="btn btn-success">Save Changes</button>
          <button type="button" class="btn btn-secondary" id="cancelEditTask">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Import Modal -->
  <div class="modal" id="importModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Import Tasks</h2>
        <button class="close-btn">&times;</button>
      </div>
      <div style="margin-bottom: 20px;">
        <div class="form-group">
          <label for="importFile">Upload File:</label>
          <input type="file" id="importFile" accept=".json">
        </div>
        <div style="text-align: center; margin: 15px 0; color: #666;">- OR -</div>
        <div class="form-group">
          <label for="importUrl">Import from URL:</label>
          <input type="url" id="importUrl" placeholder="Enter URL">
        </div>
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn btn-success" id="confirmImportBtn">Upload</button>
        <button class="btn btn-secondary" id="cancelImportBtn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Export Modal -->
  <div class="modal" id="exportModal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Export Tasks</h2>
        <button class="close-btn">&times;</button>
      </div>
      <div class="form-group">
        <label for="exportFormat">Select Format:</label>
        <select id="exportFormat">
          <option value="json">JSON</option>
          <option value="pdf">PDF</option>
          <option value="excel">Excel</option>
          <option value="csv">CSV</option>
          <option value="docx">DOCX</option>
        </select>
      </div>
      <div style="display: flex; gap: 10px; justify-content: flex-end;">
        <button class="btn btn-success" id="confirmExportBtn">Download</button>
        <button class="btn btn-secondary" id="cancelExportBtn">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    // Sample data
    let currentUser = {
      id: 1,
      firstName: 'John',
      lastName: 'Doe',
      email: 'test@example.com',
      password: '123456',
      phone: '+1 (555) 123-4567',
      country: 'USA',
      birthdate: '1985-01-15',
      joiningDate: '2023-03-10',
      role: 'Manager',
      profilePic: '/api/placeholder/200/200'
    };

    // Sample users
    const users = [
      {
        id: 1,
        firstName: 'John',
        lastName: 'Doe',
        email: 'john.doe@example.com',
        role: 'Manager',
        country: 'USA',
        profilePic: '/api/placeholder/200/200?1'
      },
      {
        id: 2,
        firstName: 'Jane',
        lastName: 'Smith',
        email: 'jane.smith@example.com',
        role: 'Staff',
        country: 'UK',
        profilePic: '/api/placeholder/200/200?2'
      },
      {
        id: 3,
        firstName: 'Michael',
        lastName: 'Johnson',
        email: 'michael.j@example.com',
        role: 'Customer',
        country: 'Canada',
        profilePic: '/api/placeholder/200/200?3'
      },
      {
        id: 4,
        firstName: 'Emily',
        lastName: 'Williams',
        email: 'emily.w@example.com',
        role: 'Admin',
        country: 'Australia',
        profilePic: '/api/placeholder/200/200?4'
      },
      {
        id: 5,
        firstName: 'David',
        lastName: 'Brown',
        email: 'david.b@example.com',
        role: 'Staff',
        country: 'Germany',
        profilePic: '/api/placeholder/200/200?5'
      },
      {
        id: 6,
        firstName: 'Sarah',
        lastName: 'Miller',
        email: 'sarah.m@example.com',
        role: 'Customer',
        country: 'France',
        profilePic: '/api/placeholder/200/200?6'
      }
    ];

    // Sample tasks
    const tasks = [
      {
        id: 1,
        title: 'Website Redesign',
        description: 'Complete the redesign of the company website with new branding elements',
        dueDate: '2025-04-25',
        priority: 'high',
        category: 'work',
        status: 'active',
        subTasks: ['Create mockups', 'Develop frontend', 'Test responsiveness'],
        notes: 'Focus on mobile-first approach'
      },
      {
        id: 2,
        title: 'Quarterly Report',
        description: 'Prepare Q1 financial report for the board meeting',
        dueDate: '2025-04-20',
        priority: 'high',
        category: 'work',
        status: 'active',
        subTasks: ['Gather data', 'Create charts', 'Write summary'],
        notes: 'Include comparison with previous quarters'
      },
      {
        id: 3,
        title: 'Gym Workout',
        description: 'Complete weekly workout routine',
        dueDate: '2025-04-18',
        priority: 'medium',
        category: 'health',
        status: 'active',
        subTasks: ['Cardio', 'Strength training', 'Stretching'],
        notes: 'Focus on core exercises'
      },
      {
        id: 4,
        title: 'Learn React Hooks',
        description: 'Study and practice React Hooks for upcoming project',
        dueDate: '2025-04-30',
        priority: 'medium',
        category: 'education',
        status: 'active',
        subTasks: ['useState', 'useEffect', 'useContext', 'Custom hooks'],
        notes: 'Complete tutorial on official React documentation'
      },
      {
        id: 5,
        title: 'Budget Planning',
        description: 'Create monthly budget plan',
        dueDate: '2025-04-16',
        priority: 'high',
        category: 'finance',
        status: 'completed',
        subTasks: ['Track expenses', 'Set saving goals', 'Allocate funds'],
        notes: 'Use the new budgeting app'
      },
      {
        id: 6,
        title: 'Team Meeting',
        description: 'Weekly team sync-up meeting',
        dueDate: '2025-04-17',
        priority: 'medium',
        category: 'work',
        status: 'active',
        subTasks: ['Prepare agenda', 'Review last week\'s progress', 'Assign new tasks'],
        notes: 'Meeting room #3 at 10 AM'
      },
      {
        id: 7,
        title: 'Dentist Appointment',
        description: 'Regular dental checkup',
        dueDate: '2025-05-05',
        priority: 'low',
        category: 'health',
        status: 'active',
        subTasks: ['Confirm appointment', 'Bring insurance card'],
        notes: 'Dr. Smith at Downtown Dental'
      },
      {
        id: 8,
        title: 'Read "Atomic Habits"',
        description: 'Finish reading the book on building good habits',
        dueDate: '2025-04-28',
        priority: 'low',
        category: 'personal',
        status: 'active',
        subTasks: ['Read chapters 5-7', 'Take notes', 'Implement one habit'],
        notes: 'Focus on the practical exercises'
      },
      {
        id: 9,
        title: 'API Integration',
        description: 'Integrate payment gateway API to the e-commerce platform',
        dueDate: '2025-04-22',
        priority: 'high',
        category: 'work',
        status: 'completed',
        subTasks: ['Read documentation', 'Implement backend', 'Test transactions'],
        notes: 'Need to coordinate with the security team'
      },
      {
        id: 10,
        title: 'Home Cleaning',
        description: 'Deep clean the apartment',
        dueDate: '2025-04-19',
        priority: 'medium',
        category: 'personal',
        status: 'completed',
        subTasks: ['Living room', 'Kitchen', 'Bathroom', 'Bedroom'],
        notes: 'Buy new cleaning supplies'
      }
    ];

    let taskHistory = { actions: [], currentIndex: -1 };
    let timer = { interval: null, seconds: 0, running: false, taskId: null };

    // DOM Elements
    const loginPage = document.getElementById('loginPage');
    const loginBtn = document.getElementById('loginBtn');
    const registerLink = document.getElementById('registerLink');
    const registrationModal = document.getElementById('registrationModal');
    const registrationForm = document.getElementById('registrationForm');
    const cancelRegistration = document.getElementById('cancelRegistration');
    const dashboard = document.getElementById('dashboard');
    const profileImg = document.getElementById('profileImg');
    const profileDropdown = document.getElementById('profileDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    const viewProfileBtn = document.getElementById('viewProfileBtn');
    const editProfileBtn = document.getElementById('editProfileBtn');
    const editProfileBtn2 = document.getElementById('editProfileBtn2');
    const profileModal = document.getElementById('profileModal');
    const editProfileModal = document.getElementById('editProfileModal');
    const editProfileForm = document.getElementById('editProfileForm');
    const cancelEditProfile = document.getElementById('cancelEditProfile');
    const themeSwitch = document.getElementById('themeSwitch');
    const timerDisplay = document.getElementById('timerDisplay');
    const dashboardNav = document.getElementById('dashboardNav');
    const usersNav = document.getElementById('usersNav');
    const dashboardContent = document.getElementById('dashboardContent');
    const usersContent = document.getElementById('usersContent');
    const totalTasksCount = document.getElementById('totalTasksCount');
    const completedTasksCount = document.getElementById('completedTasksCount');
    const pendingTasksCount = document.getElementById('pendingTasksCount');
    const addTaskBtn = document.getElementById('addTaskBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const taskList = document.getElementById('taskList');
    const usersContainer = document.getElementById('usersContainer');
    const statusFilter = document.getElementById('statusFilter');
    const categoryFilter = document.getElementById('categoryFilter');
    const priorityFilter = document.getElementById('priorityFilter');
    const dueDateFilter = document.getElementById('dueDateFilter');
    const searchInput = document.getElementById('searchInput');
    const batchActions = document.getElementById('batchActions');
    const batchDeleteBtn = document.getElementById('batchDeleteBtn');
    const batchCompleteBtn = document.getElementById('batchCompleteBtn');
    const undoBtn = document.getElementById('undoBtn');
    const redoBtn = document.getElementById('redoBtn');
    const listViewBtn = document.getElementById('listViewBtn');
    const graphViewBtn = document.getElementById('graphViewBtn');
    const graphsView = document.getElementById('graphsView');
    const addTaskModal = document.getElementById('addTaskModal');
    const addTaskForm = document.getElementById('addTaskForm');
    const cancelAddTask = document.getElementById('cancelAddTask');
    const addSubTaskBtn = document.getElementById('addSubTaskBtn');
    const subTasksList = document.getElementById('subTasksList');
    const viewTaskModal = document.getElementById('viewTaskModal');
    const editTaskModal = document.getElementById('editTaskModal');
    const importModal = document.getElementById('importModal');
    const exportModal = document.getElementById('exportModal');
    const confirmImportBtn = document.getElementById('confirmImportBtn');
    const cancelImportBtn = document.getElementById('cancelImportBtn');
    const confirmExportBtn = document.getElementById('confirmExportBtn');
    const cancelExportBtn = document.getElementById('cancelExportBtn');
    const notificationBadge = document.getElementById('notificationBadge');

    // Close all modals
    function closeAllModals() {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        modal.style.display = 'none';
      });
    }

    // Handle modal close buttons
    document.querySelectorAll('.close-btn').forEach(btn => {
      btn.addEventListener('click', closeAllModals);
    });

    // Handle closing modals when clicking outside
    window.addEventListener('click', (e) => {
      const modals = document.querySelectorAll('.modal');
      modals.forEach(modal => {
        if (e.target === modal) {
          modal.style.display = 'none';
        }
      });
    });

    // Login
    loginBtn.addEventListener('click', () => {
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      
      if (email === currentUser.email && password === currentUser.password) {
        loginPage.style.display = 'none';
        dashboard.style.display = 'block';
        updateDashboard();
      } else {
        alert('Invalid credentials. Please try again.');
      }
    });

    // Registration
    registerLink.addEventListener('click', () => {
      registrationModal.style.display = 'flex';
    });

    cancelRegistration.addEventListener('click', () => {
      registrationModal.style.display = 'none';
    });

    registrationForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      const firstName = document.getElementById('firstName').value;
      const lastName = document.getElementById('lastName').value;
      const email = document.getElementById('regEmail').value;
      const confirmEmail = document.getElementById('confirmEmail').value;
      const password = document.getElementById('regPassword').value;
      const confirmPassword = document.getElementById('confirmPassword').value;
      const birthdate = document.getElementById('birthdate').value;
      const nationality = document.getElementById('nationality').value;
      const role = document.getElementById('role').value;
      
      if (email !== confirmEmail) {
        alert('Emails do not match.');
        return;
      }
      
      if (password !== confirmPassword) {
        alert('Passwords do not match.');
        return;
      }
      
      currentUser = {
        id: users.length + 1,
        firstName,
        lastName,
        email,
        password,
        phone: '',
        country: nationality,
        birthdate,
        joiningDate: new Date().toISOString().split('T')[0],
        role,
        profilePic: '/api/placeholder/200/200'
      };
      
      users.push({
        id: currentUser.id,
        firstName,
        lastName,
        email,
        role,
        country: nationality,
        profilePic: '/api/placeholder/200/200'
      });
      
      registrationModal.style.display = 'none';
      loginPage.style.display = 'none';
      dashboard.style.display = 'block';
      updateDashboard();
      
      // Reset form
      registrationForm.reset();
    });

    // Profile Dropdown
    profileImg.addEventListener('click', () => {
      profileDropdown.classList.toggle('active');
    });

    document.addEventListener('click', (e) => {
      if (!profileImg.contains(e.target) && !profileDropdown.contains(e.target)) {
        profileDropdown.classList.remove('active');
      }
    });

    // Logout
    logoutBtn.addEventListener('click', () => {
      dashboard.style.display = 'none';
      loginPage.style.display = 'flex';
      profileDropdown.classList.remove('active');
    });

    // View Profile
    viewProfileBtn.addEventListener('click', () => {
      profileDropdown.classList.remove('active');
      document.getElementById('profileImgLg').src = currentUser.profilePic;
      document.getElementById('profileName').textContent = `${currentUser.firstName} ${currentUser.lastName}`;
      document.getElementById('profileRole').textContent = currentUser.role;
      document.getElementById('profileEmail').textContent = currentUser.email;
      document.getElementById('profilePhone').textContent = currentUser.phone || 'Not provided';
      document.getElementById('profileCountry').textContent = currentUser.country;
      document.getElementById('profileBirthdate').textContent = formatDate(currentUser.birthdate);
      document.getElementById('profileJoiningDate').textContent = formatDate(currentUser.joiningDate);
      
      profileModal.style.display = 'flex';
    });

    // Edit Profile
    editProfileBtn.addEventListener('click', () => {
      profileDropdown.classList.remove('active');
      showEditProfileModal();
    });

    editProfileBtn2.addEventListener('click', () => {
      profileModal.style.display = 'none';
      showEditProfileModal();
    });

    function showEditProfileModal() {
      document.getElementById('editProfileImg').src = currentUser.profilePic;
      document.getElementById('editFirstName').value = currentUser.firstName;
      document.getElementById('editLastName').value = currentUser.lastName;
      document.getElementById('editEmail').value = currentUser.email;
      document.getElementById('editEmail').value = currentUser.email;
      document.getElementById('editPhone').value = currentUser.phone || '';
      document.getElementById('editCountry').value = currentUser.country;
      document.getElementById('editBirthdate').value = currentUser.birthdate;
      
      editProfileModal.style.display = 'flex';
    }

    // Change Profile Picture
    document.getElementById('changeProfilePicBtn').addEventListener('click', () => {
      document.getElementById('profilePicInput').click();
    });

    document.getElementById('profilePicInput').addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        // In a real app, we would upload the file and get a URL
        // For demo purposes, we'll just use a placeholder
        const randomSeed = Math.floor(Math.random() * 1000);
        document.getElementById('editProfileImg').src = `/api/placeholder/200/200?${randomSeed}`;
      }
    });

    cancelEditProfile.addEventListener('click', () => {
      editProfileModal.style.display = 'none';
    });

    editProfileForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      currentUser.firstName = document.getElementById('editFirstName').value;
      currentUser.lastName = document.getElementById('editLastName').value;
      currentUser.email = document.getElementById('editEmail').value;
      currentUser.phone = document.getElementById('editPhone').value;
      currentUser.country = document.getElementById('editCountry').value;
      currentUser.birthdate = document.getElementById('editBirthdate').value;
      currentUser.profilePic = document.getElementById('editProfileImg').src;
      
      // Update user in users array
      const userIndex = users.findIndex(user => user.id === currentUser.id);
      if (userIndex !== -1) {
        users[userIndex] = {
          ...users[userIndex],
          firstName: currentUser.firstName,
          lastName: currentUser.lastName,
          email: currentUser.email,
          country: currentUser.country,
          profilePic: currentUser.profilePic
        };
      }
      
      // Update UI
      document.getElementById('profileImg').src = currentUser.profilePic;
      
      editProfileModal.style.display = 'none';
      alert('Profile updated successfully!');
    });

    // Theme Switch
    themeSwitch.addEventListener('click', () => {
      themeSwitch.classList.toggle('active');
      document.body.classList.toggle('dark-mode');
    });

    // Timer functionality
    function updateTimer() {
      timer.seconds++;
      
      const hours = Math.floor(timer.seconds / 3600);
      const minutes = Math.floor((timer.seconds % 3600) / 60);
      const seconds = timer.seconds % 60;
      
      timerDisplay.textContent = `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
    }

    function pad(num) {
      return num.toString().padStart(2, '0');
    }

    function startTimer(taskId) {
      if (timer.running && timer.taskId === taskId) {
        // Stop timer
        clearInterval(timer.interval);
        timer.running = false;
        timer.taskId = null;
        return false;
      } else {
        // Stop existing timer if running
        if (timer.running) {
          clearInterval(timer.interval);
        }
        
        // Start new timer
        timer.running = true;
        timer.taskId = taskId;
        timer.interval = setInterval(updateTimer, 1000);
        return true;
      }
    }

    // Navigation
    dashboardNav.addEventListener('click', () => {
      dashboardNav.classList.add('btn-primary');
      dashboardNav.classList.remove('btn-light');
      usersNav.classList.add('btn-light');
      usersNav.classList.remove('btn-primary');
      
      dashboardContent.style.display = 'block';
      usersContent.style.display = 'none';
    });

    usersNav.addEventListener('click', () => {
      usersNav.classList.add('btn-primary');
      usersNav.classList.remove('btn-light');
      dashboardNav.classList.add('btn-light');
      dashboardNav.classList.remove('btn-primary');
      
      dashboardContent.style.display = 'none';
      usersContent.style.display = 'block';
      
      renderUsers();
    });

    // Render Users
    function renderUsers() {
      usersContainer.innerHTML = '';
      
      users.forEach(user => {
        const userCard = document.createElement('div');
        userCard.className = 'user-card';
        userCard.innerHTML = `
          <img src="${user.profilePic}" alt="${user.firstName}">
          <h3>${user.firstName} ${user.lastName}</h3>
          <p>${user.role}</p>
          <p>${user.email}</p>
          <p>${user.country}</p>
        `;
        
        usersContainer.appendChild(userCard);
      });
    }

    // Task Management
    function updateDashboard() {
      // Update stats
      const totalTasks = tasks.length;
      const completedTasks = tasks.filter(task => task.status === 'completed').length;
      const pendingTasks = totalTasks - completedTasks;
      
      totalTasksCount.textContent = totalTasks;
      completedTasksCount.textContent = completedTasks;
      pendingTasksCount.textContent = pendingTasks;
      
      renderTasks();
    }

    function renderTasks() {
      // Apply filters
      let filteredTasks = [...tasks];
      
      const statusValue = statusFilter.value;
      if (statusValue !== 'all') {
        filteredTasks = filteredTasks.filter(task => {
          if (statusValue === 'active') return task.status === 'active';
          if (statusValue === 'completed') return task.status === 'completed';
          return true;
        });
      }
      
      const categoryValue = categoryFilter.value;
      if (categoryValue !== 'all') {
        filteredTasks = filteredTasks.filter(task => task.category === categoryValue);
      }
      
      const priorityValue = priorityFilter.value;
      if (priorityValue !== 'all') {
        filteredTasks = filteredTasks.filter(task => task.priority === priorityValue);
      }
      
      const searchValue = searchInput.value.toLowerCase().trim();
      if (searchValue) {
        filteredTasks = filteredTasks.filter(task => 
          task.title.toLowerCase().includes(searchValue) || 
          task.description.toLowerCase().includes(searchValue)
        );
      }
      
      // Clear task list
      taskList.innerHTML = '';
      
      // Add tasks
      filteredTasks.forEach(task => {
        const taskElement = createTaskElement(task);
        taskList.appendChild(taskElement);
      });
    }

    function createTaskElement(task) {
      const taskItem = document.createElement('div');
      taskItem.className = `task-item ${task.status === 'completed' ? 'completed' : ''}`;
      taskItem.dataset.id = task.id;
      
      // Priority indicator
      const priorityIndicator = document.createElement('div');
      priorityIndicator.className = `priority-indicator priority-${task.priority}`;
      taskItem.appendChild(priorityIndicator);
      
      // Due date indicator
      const dueIndicator = document.createElement('div');
      dueIndicator.className = 'due-indicator';
      
      const today = new Date();
      const dueDate = new Date(task.dueDate);
      const diffDays = Math.ceil((dueDate - today) / (1000 * 60 * 60 * 24));
      
      if (diffDays < 0) {
        dueIndicator.classList.add('due-expired');
      } else if (diffDays <= 2) {
        dueIndicator.classList.add('due-soon');
      } else {
        dueIndicator.classList.add('due-ok');
      }
      
      taskItem.appendChild(dueIndicator);
      
      // Checkbox
      const checkbox = document.createElement('input');
      checkbox.type = 'checkbox';
      checkbox.className = 'task-checkbox';
      checkbox.checked = task.status === 'completed';
      checkbox.addEventListener('change', () => {
        const taskId = parseInt(taskItem.dataset.id);
        toggleTaskStatus(taskId);
      });
      
      // Task info
      const taskInfo = document.createElement('div');
      taskInfo.className = 'task-info';
      
      const taskTitle = document.createElement('div');
      taskTitle.className = 'task-title';
      taskTitle.textContent = task.title;
      
      const taskMeta = document.createElement('div');
      taskMeta.className = 'task-meta';
      taskMeta.innerHTML = `
        <span>Due: ${formatDate(task.dueDate)}</span>
        <span>Priority: ${capitalizeFirstLetter(task.priority)}</span>
        <span>Category: ${capitalizeFirstLetter(task.category)}</span>
      `;
      
      taskInfo.appendChild(taskTitle);
      taskInfo.appendChild(taskMeta);
      
      // Task actions
      const taskActions = document.createElement('div');
      taskActions.className = 'task-actions';
      
      const viewBtn = document.createElement('button');
      viewBtn.className = 'task-action-btn';
      viewBtn.innerHTML = '<i>ðŸ‘ï¸</i>';
      viewBtn.title = 'View';
      viewBtn.addEventListener('click', () => {
        viewTask(task.id);
      });
      
      const editBtn = document.createElement('button');
      editBtn.className = 'task-action-btn';
      editBtn.innerHTML = '<i>âœï¸</i>';
      editBtn.title = 'Edit';
      editBtn.addEventListener('click', () => {
        editTask(task.id);
      });
      
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'task-action-btn';
      deleteBtn.innerHTML = '<i>ðŸ—‘ï¸</i>';
      deleteBtn.title = 'Delete';
      deleteBtn.addEventListener('click', () => {
        deleteTask(task.id);
      });
      
      const timerBtn = document.createElement('button');
      timerBtn.className = 'task-action-btn';
      timerBtn.innerHTML = '<i>â±ï¸</i>';
      timerBtn.title = 'Start Timer';
      timerBtn.addEventListener('click', () => {
        const isRunning = startTimer(task.id);
        timerBtn.innerHTML = isRunning ? '<i>â¸ï¸</i>' : '<i>â±ï¸</i>';
        timerBtn.title = isRunning ? 'Pause Timer' : 'Start Timer';
      });
      
      taskActions.appendChild(viewBtn);
      taskActions.appendChild(editBtn);
      taskActions.appendChild(deleteBtn);
      taskActions.appendChild(timerBtn);
      
      taskItem.appendChild(checkbox);
      taskItem.appendChild(taskInfo);
      taskItem.appendChild(taskActions);
      
      return taskItem;
    }

    function viewTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;
      
      document.getElementById('viewTaskTitle').textContent = task.title;
      document.getElementById('viewTaskDescription').textContent = task.description;
      document.getElementById('viewTaskDueDate').textContent = formatDate(task.dueDate);
      document.getElementById('viewTaskPriority').textContent = capitalizeFirstLetter(task.priority);
      document.getElementById('viewTaskCategory').textContent = capitalizeFirstLetter(task.category);
      document.getElementById('viewTaskStatus').textContent = capitalizeFirstLetter(task.status);
      document.getElementById('viewTaskNotes').textContent = task.notes || 'No notes';
      
      // Render sub tasks
      const viewSubTasksList = document.getElementById('viewSubTasksList');
      viewSubTasksList.innerHTML = '';
      
      if (task.subTasks && task.subTasks.length > 0) {
        document.getElementById('viewSubTasksContainer').style.display = 'block';
        task.subTasks.forEach(subTask => {
          const li = document.createElement('li');
          li.textContent = subTask;
          viewSubTasksList.appendChild(li);
        });
      } else {
        document.getElementById('viewSubTasksContainer').style.display = 'none';
      }
      
      // Update toggle button
      const toggleBtn = document.getElementById('viewTaskToggleBtn');
      toggleBtn.textContent = task.status === 'completed' ? 'Mark Active' : 'Mark Complete';
      toggleBtn.addEventListener('click', () => {
        toggleTaskStatus(taskId);
        viewTaskModal.style.display = 'none';
      });
      
      // Update edit button
      document.getElementById('viewTaskEditBtn').addEventListener('click', () => {
        viewTaskModal.style.display = 'none';
        editTask(taskId);
      });
      
      // Update close button
      document.getElementById('viewTaskCloseBtn').addEventListener('click', () => {
        viewTaskModal.style.display = 'none';
      });
      
      viewTaskModal.style.display = 'flex';
    }

    function editTask(taskId) {
      const task = tasks.find(t => t.id === taskId);
      if (!task) return;
      
      document.getElementById('editTaskId').value = task.id;
      document.getElementById('editTaskTitle').value = task.title;
      document.getElementById('editTaskDescription').value = task.description;
      document.getElementById('editTaskDueDate').value = task.dueDate;
      document.getElementById('editTaskPriority').value = task.priority;
      document.getElementById('editTaskCategory').value = task.category;
      document.getElementById('editTaskNotes').value = task.notes || '';
      
      // Render sub tasks
      const editSubTasksList = document.getElementById('editSubTasksList');
      editSubTasksList.innerHTML = '';
      
      if (task.subTasks && task.subTasks.length > 0) {
        task.subTasks.forEach(subTask => {
          const subTaskItem = document.createElement('div');
          subTaskItem.className = 'sub-task-item';
          subTaskItem.style.display = 'flex';
          subTaskItem.style.gap = '10px';
          subTaskItem.style.marginBottom = '10px';
          
          const input = document.createElement('input');
          input.type = 'text';
          input.value = subTask;
          input.style.flex = '1';
          input.style.padding = '8px';
          input.style.border = '1px solid #ddd';
          input.style.borderRadius = '8px';
          
          const removeBtn = document.createElement('button');
          removeBtn.type = 'button';
          removeBtn.className = 'btn btn-danger btn-sm remove-sub-task';
          removeBtn.textContent = 'Ã—';
          removeBtn.addEventListener('click', () => {
            subTaskItem.remove();
          });
          
          subTaskItem.appendChild(input);
          subTaskItem.appendChild(removeBtn);
          editSubTasksList.appendChild(subTaskItem);
        });
      }
      
      // Add sub task button
      document.getElementById('editAddSubTaskBtn').addEventListener('click', () => {
        addSubTask(editSubTasksList);
      });
      
      // Cancel button
      document.getElementById('cancelEditTask').addEventListener('click', () => {
        editTaskModal.style.display = 'none';
      });
      
      // Form submission
      const editTaskForm = document.getElementById('editTaskForm');
      editTaskForm.onsubmit = function(e) {
        e.preventDefault();
        
        const taskId = parseInt(document.getElementById('editTaskId').value);
        const taskIndex = tasks.findIndex(t => t.id === taskId);
        
        if (taskIndex !== -1) {
          // Get sub tasks
          const subTaskInputs = editSubTasksList.querySelectorAll('input');
          const subTasks = Array.from(subTaskInputs).map(input => input.value);
          
          // Save task history
          saveTaskHistory('update', tasks[taskIndex]);
          
          // Update task
          tasks[taskIndex] = {
            ...tasks[taskIndex],
            title: document.getElementById('editTaskTitle').value,
            description: document.getElementById('editTaskDescription').value,
            dueDate: document.getElementById('editTaskDueDate').value,
            priority: document.getElementById('editTaskPriority').value,
            category: document.getElementById('editTaskCategory').value,
            notes: document.getElementById('editTaskNotes').value,
            subTasks
          };
          
          renderTasks();
          editTaskModal.style.display = 'none';
        }
      };
      
      editTaskModal.style.display = 'flex';
    }

    function deleteTask(taskId) {
      if (confirm('Are you sure you want to delete this task?')) {
        const taskIndex = tasks.findIndex(t => t.id === taskId);
        
        if (taskIndex !== -1) {
          // Save task history
          saveTaskHistory('delete', tasks[taskIndex]);
          
          // Remove task
          tasks.splice(taskIndex, 1);
          renderTasks();
          updateDashboard();
        }
      }
    }

    function toggleTaskStatus(taskId) {
      const taskIndex = tasks.findIndex(t => t.id === taskId);
      
      if (taskIndex !== -1) {
        // Save task history
        saveTaskHistory('update', tasks[taskIndex]);
        
        // Toggle status
        tasks[taskIndex].status = tasks[taskIndex].status === 'completed' ? 'active' : 'completed';
        
        renderTasks();
        updateDashboard();
      }
    }

    // Add Task
    addTaskBtn.addEventListener('click', () => {
      // Reset form
      addTaskForm.reset();
      
      // Clear sub tasks
      subTasksList.innerHTML = '';
      addSubTask(subTasksList);
      
      addTaskModal.style.display = 'flex';
    });

    cancelAddTask.addEventListener('click', () => {
      addTaskModal.style.display = 'none';
    });

    addTaskForm.addEventListener('submit', (e) => {
      e.preventDefault();
      
      // Get values
      const title = document.getElementById('taskTitle').value;
      const description = document.getElementById('taskDescription').value;
      const dueDate = document.getElementById('taskDueDate').value;
      const priority = document.getElementById('taskPriority').value;
      const category = document.getElementById('taskCategory').value;
      const notes = document.getElementById('taskNotes').value;
      
      // Get sub tasks
      const subTaskInputs = subTasksList.querySelectorAll('input');
      const subTasks = Array.from(subTaskInputs)
        .map(input => input.value)
        .filter(value => value.trim() !== '');
      
      // Create new task
      const newTask = {
        id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
        title,
        description,
        dueDate,
        priority,
        category,
        status: 'active',
        subTasks,
        notes
      };
      
      // Save task history
      saveTaskHistory('add', null, newTask);
      
      // Add task
      tasks.push(newTask);
      
      renderTasks();
      updateDashboard();
      
      addTaskModal.style.display = 'none';
    });

    // Add Sub Task
    addSubTaskBtn.addEventListener('click', () => {
      addSubTask(subTasksList);
    });

    function addSubTask(container) {
      const subTaskItem = document.createElement('div');
      subTaskItem.className = 'sub-task-item';
      subTaskItem.style.display = 'flex';
      subTaskItem.style.gap = '10px';
      subTaskItem.style.marginBottom = '10px';
      
      const input = document.createElement('input');
      input.type = 'text';
      input.placeholder = 'Sub task';
      input.style.flex = '1';
      input.style.padding = '8px';
      input.style.border = '1px solid #ddd';
      input.style.borderRadius = '8px';
      
      const removeBtn = document.createElement('button');
      removeBtn.type = 'button';
      removeBtn.className = 'btn btn-danger btn-sm remove-sub-task';
      removeBtn.textContent = 'Ã—';
      removeBtn.addEventListener('click', () => {
        subTaskItem.remove();
      });
      
      subTaskItem.appendChild(input);
      subTaskItem.appendChild(removeBtn);
      container.appendChild(subTaskItem);
    }

    // Event delegation for remove sub task buttons
    document.addEventListener('click', (e) => {
      if (e.target.classList.contains('remove-sub-task')) {
        e.target.closest('.sub-task-item').remove();
      }
    });

    // Task History (Undo/Redo)
    function saveTaskHistory(action, oldTask, newTask) {
      // Remove future actions if we're not at the end
      if (taskHistory.currentIndex < taskHistory.actions.length - 1) {
        taskHistory.actions = taskHistory.actions.slice(0, taskHistory.currentIndex + 1);
      }
      
      // Add action
      taskHistory.actions.push({
        action,
        oldTask: oldTask ? { ...oldTask } : null,
        newTask: newTask ? { ...newTask } : null
      });
      
      // Update index
      taskHistory.currentIndex = taskHistory.actions.length - 1;
      
      // Enable/disable undo/redo buttons
      updateUndoRedoButtons();
    }

    function updateUndoRedoButtons() {
      undoBtn.disabled = taskHistory.currentIndex < 0;
      redoBtn.disabled = taskHistory.currentIndex >= taskHistory.actions.length - 1;
      
      undoBtn.style.opacity = undoBtn.disabled ? '0.5' : '1';
      redoBtn.style.opacity = redoBtn.disabled ? '0.5' : '1';
    }

    undoBtn.addEventListener('click', () => {
      if (taskHistory.currentIndex >= 0) {
        const action = taskHistory.actions[taskHistory.currentIndex];
        
        switch (action.action) {
          case 'add':
            // Remove added task
            const addIndex = tasks.findIndex(t => t.id === action.newTask.id);
            if (addIndex !== -1) {
              tasks.splice(addIndex, 1);
            }
            break;
          case 'update':
            // Restore old task
            const updateIndex = tasks.findIndex(t => t.id === action.oldTask.id);
            if (updateIndex !== -1) {
              tasks[updateIndex] = { ...action.oldTask };
            }
            break;
          case 'delete':
            // Restore deleted task
            tasks.push({ ...action.oldTask });
            break;
        }
        
        taskHistory.currentIndex--;
        updateUndoRedoButtons();
        renderTasks();
        updateDashboard();
      }
    });

    redoBtn.addEventListener('click', () => {
      if (taskHistory.currentIndex < taskHistory.actions.length - 1) {
        taskHistory.currentIndex++;
        const action = taskHistory.actions[taskHistory.currentIndex];
        
        switch (action.action) {
          case 'add':
            // Add task again
            tasks.push({ ...action.newTask });
            break;
          case 'update':
            // Apply update again
            const updateIndex = tasks.findIndex(t => t.id === action.oldTask.id);
            if (updateIndex !== -1) {
              tasks[updateIndex] = { ...action.newTask || action.oldTask };
            }
            break;
          case 'delete':
            // Delete task again
            const deleteIndex = tasks.findIndex(t => t.id === action.oldTask.id);
            if (deleteIndex !== -1) {
              tasks.splice(deleteIndex, 1);
            }
            break;
        }
        
        updateUndoRedoButtons();
        renderTasks();
        updateDashboard();
      }
    });

    // View Switching
    listViewBtn.addEventListener('click', () => {
      listViewBtn.classList.add('active');
      graphViewBtn.classList.remove('active');
      
      taskList.style.display = 'block';
      graphsView.style.display = 'none';
    });

    graphViewBtn.addEventListener('click', () => {
      graphViewBtn.classList.add('active');
      listViewBtn.classList.remove('active');
      
      taskList.style.display = 'none';
      graphsView.style.display = 'grid';
    });

    // Filters
    statusFilter.addEventListener('change', renderTasks);
    categoryFilter.addEventListener('change', renderTasks);
    priorityFilter.addEventListener('change', renderTasks);
    dueDateFilter.addEventListener('change', renderTasks);
    searchInput.addEventListener('input', renderTasks);

    // Import/Export
    importBtn.addEventListener('click', () => {
      importModal.style.display = 'flex';
    });

    exportBtn.addEventListener('click', () => {
      exportModal.style.display = 'flex';
    });

    cancelImportBtn.addEventListener('click', () => {
      importModal.style.display = 'none';
    });

    cancelExportBtn.addEventListener('click', () => {
      exportModal.style.display = 'none';
    });

    confirmImportBtn.addEventListener('click', () => {
      // In a real app, this would handle file uploads
      // For demo, we'll just add some sample tasks
      const newTasks = [
        {
          id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 1 : 1,
          title: 'Imported Task 1',
          description: 'This is an imported task',
          dueDate: '2025-05-15',
          priority: 'medium',
          category: 'work',
          status: 'active',
          subTasks: ['Subtask 1', 'Subtask 2'],
          notes: 'Imported via JSON'
        },
        {
          id: tasks.length > 0 ? Math.max(...tasks.map(t => t.id)) + 2 : 2,
          title: 'Imported Task 2',
          description: 'Another imported task',
          dueDate: '2025-05-20',
          priority: 'high',
          category: 'personal',
          status: 'active',
          subTasks: ['Subtask A', 'Subtask B'],
          notes: 'Imported via JSON'
        }
      ];
      
      tasks.push(...newTasks);
      
      renderTasks();
      updateDashboard();
      
      importModal.style.display = 'none';
      alert('Tasks imported successfully!');
    });

    confirmExportBtn.addEventListener('click', () => {
      // In a real app, this would generate a file to download
      // For demo, we'll just show an alert
      const format = document.getElementById('exportFormat').value;
      
      exportModal.style.display = 'none';
      alert(`Tasks exported as ${format.toUpperCase()} successfully!`);
    });

    // Helper Functions
    function formatDate(dateString) {
      const date = new Date(dateString);
      return date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    }

    function capitalizeFirstLetter(string) {
      return string.charAt(0).toUpperCase() + string.slice(1);
    }

    // Initialize
    updateDashboard();
    updateUndoRedoButtons();
  </script>
</body>
</html>
